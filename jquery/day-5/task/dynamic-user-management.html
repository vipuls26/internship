<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dynamic User Management</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="alert d-none" id="alertBox"></div>

      <form action="" method="post" id="formId">
        <div class="row g-4">
          <div class="col-12 col-md-6">
            <label for="name" class="form-label">Name</label>
            <input
              type="text"
              name="name"
              id="name"
              class="form-control border border-info"
            />
            <small class="text-danger invalid-feedback" id="nameInput"
              >name is missing</small
            >
          </div>

          <div class="col-12 col-md-6">
            <label for="email" class="form-label">Email</label>
            <input
              type="email"
              name="email"
              id="email"
              class="form-control border border-info"
            />
            <small class="form-text text-danger invalid-feedback"
              >your email is not valid</small
            >
          </div>

          <div class="col-12 col-md-12 w-100 text-center">
            <input
              type="submit"
              value="Add"
              class="btn btn-warning"
              id="submit"
            />
          </div>
        </div>
      </form>

      
      
      <hr />

      <table class="table table-striped">
        <thead>
          <tr class="table table-dark">
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="userList" class="userList"></tbody>
      </table>
    </div>

    <script>
      function validateName() {
        let nameInput = $("#name");
        let name = nameInput.val().trim();

        if (name === "") {
          $("#nameInput").text("Name is required").show();
          nameInput.addClass("is-invalid").removeClass("border-success");
          return false;
        }

        if (name.length < 3 || name.length > 10) {
          $("#nameInput")
            .text("Name must be between 3 to 10 characters")
            .show();
          nameInput.addClass("is-invalid").removeClass("border-success");
          return false;
        }

        $("#nameInput").hide();
        nameInput
          .removeClass("is-invalid border-danger border-info")
          .addClass("border-success");
        return true;
      }

      function validateEmail() {
        let emailInput = $("#email");
        let email = emailInput.val().trim();
        let regex =
          /^([_\-\.0-9a-zA-Z]+)@([_\-\.0-9a-zA-Z]+)\.([a-zA-Z]{2,5})$/;

        if (!regex.test(email)) {
          emailInput.addClass("is-invalid").removeClass("border-success");
          return false;
        }

        emailInput
          .removeClass("is-invalid border-danger border-info")
          .addClass("border-success");
        return true;
      }

      $(document).ready(function () {
        $("#name").on("keyup blur", validateName);
        $("#email").on("keyup blur", validateEmail);

        $("#submit").click(function (e) {
          e.preventDefault();

          if (!validateName() || !validateEmail()) {
            showMessage("name and email can not be empty", "danger");
            return;
          }

          let addName = $("#name").val().trim();
          let addEmail = $("#email").val().trim();

          // duplicate name check
          let duplicateName = false;
          let duplicateEmail = false;
          $("#userList tr").each(function () {
            if ($(this).children("td").eq(1).text() === addName) {
              duplicateName = true;
            }
          });

          $("#userList tr").each(function () {
            if ($(this).children("td").eq(2).text() === addEmail) {
              duplicateEmail = true;
            }
          });

          if (duplicateName) {
            showMessage("Name already exists", "danger");
            return;
          }

          if (duplicateEmail) {
            showMessage("email already exists", "danger");
            return;
          }

          let id =
            $("#userList tr").length === 0
              ? 1
              : parseInt($("#userList tr:last td:first").text()) + 1;

          $("#userList").append(`
        <tr class="table-dark">
          <td>${id}</td>
          <td>${addName}</td>
          <td>${addEmail}</td>
          <td>
            <button class="btn btn-danger delete mx-2 my-1">Delete</button>
            <button class="btn btn-success edit mx-2 my-1">Edit </button>
          </td>
        </tr>
      `);

          showMessage("User added successfully", "success");
          $("#formId")[0].reset();
          $(".border-success").removeClass("border-success");
        });

        $("#userList").on("click", ".delete", function () {
          alert("confirm to delete this user");
          $(this)
            .closest("tr")
            .fadeOut(() => $(this).remove());
          showMessage("User deleted", "warning");
        });

        $("#userList").on("click", ".edit", function () {
          let btn = $(this);
          let row = btn.closest("tr");

          if (btn.text() === "Edit") {
            row
              .children("td")
              .eq(1)
              .attr("contenteditable", true)
              .addClass("editable");
            row
              .children("td")
              .eq(2)
              .attr("contenteditable", true)
              .addClass("editable");

            btn
              .text("Update")
              .removeClass("btn-success")
              .addClass("btn-warning");
          } else {
            let name = row.children("td").eq(1).text().trim();
            let email = row.children("td").eq(2).text().trim();

            if (name === "" || email === "") {
              showMessage("Name and Email cannot be empty", "danger");
              return;
            }

            row
              .children("td")
              .removeAttr("contenteditable")
              .removeClass("editable");
            btn.text("Edit").removeClass("btn-warning").addClass("btn-success");

            showMessage("User updated successfully", "success");
          }
        });

        function showMessage(msg, type) {
          $("#alertBox")
            .removeClass(
              "d-none alert-success alert-danger alert-warning alert-info",
            )
            .addClass("alert-" + type)
            .text(msg)
            .fadeIn();

          setTimeout(() => $("#alertBox").fadeOut(), 3000);
        }
      });
    </script>
  </body>
</html>
